hosts:
    mcd_c :
            interfaces:
                    - link: tofino1
                      ip: 10.0.0.9/24
                      mac: '00:02:c9:3a:84:00'
    mcd_s :
            interfaces:
                    - link: tofino2
                      ip: 10.0.0.10/24
                      mac: '7c:fe:90:1c:36:81'
    iperf_c :
            interfaces:
                    - link: tofino1
                      ip: 10.0.0.11/24
                      mac: '24:8a:07:8f:eb:00'
    iperf_s :
            interfaces:
                    - link: tofino2
                      ip: 10.0.0.12/24
                      mac: '24:8a:07:5b:15:35'

#define SEG_DECODE 2
#define SEG_DECOMPRESS 4
#define SEG_KV_STORE 6
#define SEG_COMPRESS 8
#define SEG_ENCODE 10
#define SEG_FORWARD 12

switches:
    tofino1:
        cfg: ../../../build/bmv2/Tclust_tofino.json
        interfaces:
            - link: dropper
              port: 19
            - link: mcd_c
              port: 2
            - link: iperf_c
              port: 1
            - link: fpga_mcd
              port: 120
            - link: fpga_encd
              port: 121
            - link: fpga_comp
              port: 130
        cmds:
            # Enable k-v store for                                  UDP       source=11211
            - table_add kv_booster.boost kv_booster.set_enabled 0x11&&&0xFF 0x2BCB&&&0xFFFF 0x0000&&&0x0000 => 1 1
            # Enable k-v store for                                  UDP                        dest=11211
            - table_add kv_booster.boost kv_booster.set_enabled 0x11&&&0xFF 0x0000&&&0x0000 0x2BCB&&&0xFFFF => 1 2


            # Set basic egress ports for mac addresses
            - table_add mac_forwarding set_egress 0x248a078feb00 => 1
            - table_add mac_forwarding set_egress 0x0002c93a8400 => 2
            - table_add mac_forwarding set_egress 0x248a075b1535 => 19
            - table_add mac_forwarding set_egress 0x7cfe901c3681 => 19

            # Set offloads for available boosters
            - table_add offload set_egress 6 => 120  # KV_STORE
            - table_add offload strip_fp_hdr 12 =>   # FORWARD

    fpga_mcd:
        cfg: ../../../build/bmv2/Tclust_mcd.json

    fpga_encd:
        cfg: ../../../build/bmv2/Tclust_noop.json

    fpga_decd:
        cfg: ../../../build/bmv2/Tclust_noop.json

    fpga_comp:
        cfg: ../../../build/bmv2/Tclust_noop.json

    fpga_dcomp:
        cfg: ../../../build/bmv2/Tclust_noop.json

    dropper:
        cfg: ../../../build/bmv2/Forwarder.json
        interfaces:
            - link: tofino1
              port: 0
            - link: tofino2
              port: 1
        cmds:
            - table_add forward set_egress 0 => 1
            - table_add forward set_egress 1 => 0

    tofino2:
        cfg: ../../../build/bmv2/Tclust_tofino.json
        interfaces:
            - link: dropper
              port: 20
            - link: fpga_decd
              port: 122
            - link: iperf_s
              port: 3
            - link: mcd_s
              port: 4
            - link: fpga_dcomp
              port: 131
        cmds:
            # Set egress ports for MAC addresses
            - table_add mac_forwarding set_egress 0x248a078feb00 => 20
            - table_add mac_forwarding set_egress 0x0002c93a8400 => 20
            - table_add mac_forwarding set_egress 0x248a075b1535 => 3
            - table_add mac_forwarding set_egress 0x7cfe901c3681 => 4

            - table_add offload strip_fp_hdr 12 =>   # FORWARD
