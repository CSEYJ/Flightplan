// Simple module deciding whether to drop (or not) a packet.
// Nik Sultana, DCOMP project, UPenn, January 2018
//
// NOTE:
// * Uses the module interface for SDNet, as generated by Lei Shi on 22/01/2018.
// * Assumes that output won't be read before input is provided (thus
//   ...output_VALID is X until ...input_VALID != X).

`timescale 1 ps / 1 ps

module drop_or_not_0_t
#(parameter RR_WIDTH = 3)
( input wire clk_lookup,
  input wire rst,
  input wire tuple_in_drop_or_not_input_VALID,
  input wire tuple_in_drop_or_not_input_DATA,
  output wire tuple_out_drop_or_not_output_VALID,
  output wire tuple_out_drop_or_not_output_DATA
);

reg [(RR_WIDTH-1):0] count;

always @(posedge rst) begin
  count <= 0 - 1;
end

always @(posedge clk_lookup) begin
  if (tuple_in_drop_or_not_input_VALID && tuple_in_drop_or_not_input_DATA) begin
    count <= count - 1;
  end
end

assign tuple_out_drop_or_not_output_VALID = 0 || tuple_in_drop_or_not_input_VALID;
assign tuple_out_drop_or_not_output_DATA = (count == 0);

endmodule
